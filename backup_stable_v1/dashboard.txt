# Gleap Support Dashboard - Master Prompt & Blueprint

## 1. Project Overview
**Goal:** Build a high-performance, real-time support dashboard for monitoring agent performance and ticket activity using the Gleap API.
**Tech Stack:** Vanilla JavaScript (ES6+), HTML5, CSS3 (Custom Variables, Flexbox/Grid).
**Deployment:** Vercel Static Hosting (Single Page Application).
**Theme:** "Brilliant" Dark Mode (Deep blues, gradients, glassmorphism).

## 2. Core Architecture
- **Client-Side Only:** No backend server. All logic resides in `dashboard.js`.
- **Direct API Calls:** The browser fetches data directly from Gleap API endpoints using `fetch()`.
- **Authentication:** Hardcoded `GLEAP_TOKEN` and `PROJECT_ID` (Note: For production, consider env vars if possible).
- **Timezone:** STRICTLY **IST (Indian Standard Time, UTC+5:30)**. All calculations, displays, and filters must respect this offset.

## 3. Key Features & Logic

### A. Overview Tab (Real-Time Performance)
- **Data Source:** `https://dashapi.gleap.io/v3/statistics/lists` (Team Performance List).
- **Metrics Displayed:**
  - **Agent:** Avatar + Name + Email.
  - **Tickets:** Total tickets handled (`ticketActivityCount`).
  - **Closed:** Tickets closed (`rawClosed`).
  - **Reply Time:** Median reply time (formatted as `X.Yh`).
  - **First Reply:** Median time to first reply.
  - **Rating:** Average rating (Color-coded: >90 Green, >75 Normal, else Red).
  - **Last Seen:** Converted to IST.
  - **Hours Active:** Calculated from seconds (`hoursActive`).
- **Sorting:** Clickable headers to sort by any metric (Ascending/Descending).
- **Filtering:** Search bar to filter agents by name/email.

### B. Shifts Tab (Roster Management)
- **Logic:** Hardcoded roster in `SHIFTS_ROSTER` object.
  - **Morning:** 05:00 - 14:00 (Leader: Pratik).
  - **Noon:** 12:00 - 21:00 (Leader: Vanshree).
  - **Night:** 20:00 - 05:00 (Leader: Evan).
- **Display:** Filters the main agent list into these three buckets based on email matching.
- **Leader Badge:** Visual indicator for shift leaders.

### C. Archived Tickets Tab (The "Power" View)
- **Data Source:** `https://dashapi.gleap.io/v3/tickets` (Filtered by `archived=true`, `type=INQUIRY`).
- **Time Window Logic:**
  - **Presets:** Last 1h, 2h, 4h, 8h, 24h.
  - **Custom Range:** Date/Time pickers for Start and End (IST).
  - **Limit Handling:** Automatically adjusts API limit (200 for short ranges, 1000 for >8h).
- **Processing:**
  - Fetches *all* tickets.
  - Filters client-side based on `archivedAt` timestamp converted to IST.
  - Counts tickets per agent within the selected window.
- **Hourly Matrix (Heatmap):**
  - **X-Axis:** Hours 00 - 23.
  - **Y-Axis:** Agents (Sticky column).
  - **Cells:** Count of tickets archived in that specific hour.
  - **Total Column:** Sum of row, sortable (High-Low / Low-High).
  - **Visuals:** Green highlights for active hours.
- **View Tickets Modal:**
  - "View Tickets" button opens a popup.
  - Lists individual tickets with clickable links to Gleap (`/inquiries/{id}`).
  - Shows exact archived time in IST.

## 4. Nuances & "Gotchas"
1.  **IST Conversion:** The API returns UTC. You MUST add `330 minutes` (5.5 hours) to every timestamp before display or comparison.
    ```javascript
    const IST_OFFSET_MINUTES = 330;
    const istDate = new Date(utcDate.getTime() + IST_OFFSET_MINUTES * 60000);
    ```
2.  **Default Time:** On load, the dashboard must default to the **Current Hour** (e.g., 4:00 to 5:00) based on the user's local time.
3.  **HTML Structure:** The `index.html` relies on specific IDs (`archivedView`, `archivedWindow`, `ticketModal`). Do not break the nesting of these containers.
4.  **CSS:** Uses `position: sticky` for the matrix first column. Requires `border-collapse: separate` on the table to work.

## 5. Future Improvements (If needed)
- **Dynamic Shifts:** Move roster to a JSON config or API.
- **Environment Variables:** Secure the API token.
- **More Charts:** Add line charts for activity over time.

---
*Generated by Antigravity AI - November 24, 2025*
