# Gleap Dashboard - Master Protocol & Blueprint
# VERSION: 2.0 (Stable)

## üö® CRITICAL RULES OF ENGAGEMENT (READ BEFORE EDITING)
1.  **HTML Structure Integrity:**
    *   The `index.html` file relies on specific nesting.
    *   **NEVER** delete or move the `<section id="mainControls">` or `<div id="overviewView">` without understanding their relationship.
    *   `mainControls` is SHARED between Overview and Shifts. It must sit *outside* `overviewView`.
    *   `archivedView` has its own controls.
2.  **View Switching Logic:**
    *   In `dashboard.js`, the `switchView(view)` function controls visibility.
    *   It must toggle `mainControls` visibility: `remove("hidden")` for Overview/Shifts, `add("hidden")` for Archived.
3.  **IST Timezone Mandate:**
    *   All times are IST (UTC+5:30).
    *   `IST_OFFSET_MINUTES = 330`.
    *   Always convert UTC from API to IST before display.
4.  **Default Time Range:**
    *   On load, set inputs to **Current Hour** (e.g., 4:00-5:00) using local time.
    *   Do not leave inputs empty.

## üèóÔ∏è Architecture Overview

### 1. File Structure
*   `public/index.html`: Single Page App structure.
*   `public/dashboard.js`: All logic (API, Rendering, State).
*   `public/style.css`: Dark theme styling.

### 2. Views & Controls
*   **Header:** Title + Tabs (Overview, Shifts, Archived).
*   **Main Controls (`#mainControls`):**
    *   Start/End Date Pickers (IST).
    *   Fetch Button.
    *   Quick Actions (1h, 4h, 24h).
    *   *Visible in:* Overview, Shifts.
*   **Overview (`#overviewView`):**
    *   Summary Cards.
    *   Main Agent Table.
*   **Shifts (`#shiftsView`):**
    *   3 Panels: Morning, Noon, Night.
    *   Uses same data as Overview.
    *   *New:* Displays "Total: XX" tickets in headers.
*   **Archived (`#archivedView`):**
    *   **Own Controls:** Window Selector (1h...24h, Custom), Search.
    *   Archived Table.
    *   Hourly Matrix (Heatmap).
    *   *Lazy Loaded:* Only fetches on tab click.

### 3. API Endpoints (Direct Calls)
*   **Team Performance:** `https://dashapi.gleap.io/v3/statistics/lists`
    *   Used for: Overview, Shifts.
    *   Params: `startDate`, `endDate`, `team`, `aggsType=MEDIAN`.
*   **Archived Tickets:** `https://dashapi.gleap.io/v3/tickets`
    *   Used for: Archived View.
    *   Params: `archived=true`, `type=INQUIRY`, `limit` (dynamic).

## üìù Common Pitfalls (How we broke it before)
*   **Issue:** Moving `controls` inside `overviewView`.
    *   **Result:** Controls disappeared when switching to Shifts.
    *   **Fix:** Keep `controls` separate and toggle visibility in JS.
*   **Issue:** Broken HTML during automated edits.
    *   **Result:** Sections deleted, tabs unclickable.
    *   **Fix:** Always verify HTML structure after `replace_file_content`.

---
*Use this file to restore context if the project state becomes corrupted.*
