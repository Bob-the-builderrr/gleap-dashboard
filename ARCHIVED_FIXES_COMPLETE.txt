COMPLETE FIX FOR ARCHIVED TICKETS
==========================================

This document contains ALL the changes needed to fix the archived tickets section.
Apply these changes manually to avoid file corruption.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TASK 1: UPDATE HTML - New UI Layout
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FILE: public/index.html
LINES TO REPLACE: 190-211

REMOVE THESE LINES (190-211):
-----------------------------------------------------
    <!-- Archived Section -->
    <div id="archivedView" class="hidden">
      <div class="panel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
          <h2 style="font-size: 1.5rem;">ğŸ“¦ Archived Tickets</h2>
          <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
            <div id="archivedCustomRange" class="hidden" style="display: flex; gap: 0.5rem; align-items: center;">
              <input type="datetime-local" id="archivedStart" style="padding: 0.4rem;">
              <span style="color: var(--text-muted);">-</span>
              <input type="datetime-local" id="archivedEnd" style="padding: 0.4rem;">
              <button id="archivedFetchBtn" class="primary-btn" style="padding: 0.4rem 0.8rem;">Go</button>
            </div>
            <select id="archivedWindow">
              <option value="60">Last 1 hour</option>
              <option value="120">Last 2 hours</option>
              <option value="240">Last 4 hours</option>
              <option value="480">Last 8 hours</option>
              <option value="1440">Last 24 hours</option>
              <option value="custom">Custom Range</option>
            </select>
            <input id="archivedSearch" type="search" placeholder="ğŸ” Search archived...">
          </div>
        </div>

REPLACE WITH:
-----------------------------------------------------
    <!-- Archived Section -->
    <div id="archivedView" class="hidden">
      <div class="panel">
        <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem;">ğŸ“¦ Archived & Done Tickets</h2>
        
        <!-- Archived Time Controls (for table) -->
        <section class="controls" style="margin-bottom: 1.5rem;">
          <div style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
            <div>
              <label for="archivedStart">Start Time (IST)</label>
              <input type="datetime-local" id="archivedStart">
            </div>
            <div>
              <label for="archivedEnd">End Time (IST)</label>
              <input type="datetime-local" id="archivedEnd">
            </div>
            <button id="archivedFetchBtn" class="primary-btn">ğŸ”„ Fetch Data</button>

            <div style="margin-left: auto; display: flex; gap: 0.5rem; align-items: center;">
              <input id="archivedSearch" type="search" placeholder="ğŸ” Search agents..." style="width: 200px;">
              <div class="quick-actions">
                <button class="ghost-btn" data-archived-hours="1">1h</button>
                <button class="ghost-btn" data-archived-hours="2">2h</button>
                <button class="ghost-btn" data-archived-hours="4">4h</button>
                <button class="ghost-btn" data-archived-hours="8">8h</button>
                <button class="ghost-btn" data-archived-hours="24">24h</button>
              </div>
            </div>
          </div>
        </section>



â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TASK 2: UPDATE JAVASCRIPT - Fix Custom Range & Separate Matrix
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FILE: public/dashboard.js

PART A: Add helper function for archived quick actions
-------------------------------------------------------
LOCATION: Add after line 832 (after handleQuickRange function)

ADD THIS NEW FUNCTION:
```javascript
function handleArchivedQuickRange(hours) {
  const end = new Date(); // Current time
  const start = new Date(end.getTime() - hours * 60 * 60 * 1000); // Rolling window
  const startValue = toInputValue(start);
  const endValue = toInputValue(end);
  
  dom.archivedStart.value = startValue;
  dom.archivedEnd.value = endValue;
  
  // Trigger fetch
  fetchAndRenderArchived();
}
```


PART B: Completely replace fetchAndRenderArchived function
-------------------------------------------------------
LOCATION: Lines 695-734 (the entire fetchAndRenderArchived function)

REMOVE THE OLD FUNCTION AND REPLACE WITH:
```javascript
async function fetchAndRenderArchived() {
  // Always use the datetime inputs (no more dropdown logic)
  const customStart = dom.archivedStart.value;
  const customEnd = dom.archivedEnd.value;

  if (!customStart || !customEnd) {
    showError("Please select start and end times");
    return;
  }

  setLoading(true);

  try {
    // Fetch both archived and done tickets for the TABLE
    const [archivedTickets, doneTickets] = await Promise.all([
      fetchArchivedTickets(0, customStart, customEnd),
      fetchDoneTickets(0, customStart, customEnd)
    ]);

    // Merge tickets for TABLE
    const allTickets = [...archivedTickets, ...doneTickets];
    const { agentMap } = processArchivedTickets(allTickets, 0, customStart, customEnd);
    renderArchivedTable(agentMap);

    // SEPARATE: Fetch last 24 hours for MATRIX (independent of filter)
    const now = new Date();
    const matrix24HStart = new Date(now.getTime() - 24 * 60 * 60 * 1000);
    const matrixStartValue = toInputValue(matrix24HStart);
    const matrixEndValue = toInputValue(now);

    const [matrix24Archived, matrix24Done] = await Promise.all([
      fetchArchivedTickets(0, matrixStartValue, matrixEndValue),
      fetchDoneTickets(0, matrixStartValue, matrixEndValue)
    ]);

    const matrixTickets = [...matrix24Archived, ...matrix24Done];
    const { hourlyMap } = processArchivedTickets(matrixTickets, 1440, null, null);
    renderHourlyBreakdown(hourlyMap);

  } catch (err) {
    showError(err.message || "Failed to load archived tickets");
    console.error(err);
  } finally {
    setLoading(false);
  }
}
```


PART C: Update init() function - Add archived quick action listeners
-------------------------------------------------------
LOCATION: Inside init() function, around line 895

ADD THESE EVENT LISTENERS (after the existing quick-actions listener):
```javascript
  // Archived quick actions
  document.querySelectorAll('[data-archived-hours]').forEach(btn => {
    btn.addEventListener("click", () => handleArchivedQuickRange(Number(btn.dataset.archivedHours)));
  });
```


PART D: Update init() function - Set default archived range
-------------------------------------------------------
LOCATION: Inside init() function, after line 910 (after setting main time range)

ADD THIS CODE:
```javascript
  // Set default archived time range: Last 1 hour
  const archNow = new Date();
  const archStart = new Date(archNow.getTime() - 1 * 60 * 60 * 1000);
  dom.archivedStart.value = toInputValue(archStart);
  dom.archivedEnd.value = toInputValue(archNow);
```


PART E: Remove old archived event listeners
-------------------------------------------------------
LOCATION: Around line 880-885

REMOVE THESE LINES:
```javascript
  dom.archivedWindow.addEventListener("change", fetchAndRenderArchived);
  dom.archivedFetchBtn.addEventListener("click", () => {
    // Force fetch for custom range
    if (dom.archivedWindow.value === "custom") {
      fetchAndRenderArchived();
    }
  });
```

REPLACE WITH:
```javascript
  dom.archivedFetchBtn.addEventListener("click", fetchAndRenderArchived);
```


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SUMMARY OF CHANGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. **HTML UI**: Removed dropdown, added datetime pickers + quick buttons (1h/2h/4h/8h/24h)
2. **fetchAndRenderArchived**: 
   - Now uses datetime inputs directly (no dropdown logic)
   - Fetches custom range for TABLE
   - Fetches LAST 24 HOURS for MATRIX (independent!)
3. **Event Listeners**: Added quick action buttons, removed dropdown listener
4. **Default Values**: Sets last 1 hour on page load

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
AFTER APPLYING, TEST:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Go to Archived tab
2. Should see datetime pickers already filled with last 1 hour
3. Click "Fetch Data" - should load data
4. Click "1h", "2h", etc - should update inputs and fetch
5. Matrix should ALWAYS show last 24 hours regardless of filter above
