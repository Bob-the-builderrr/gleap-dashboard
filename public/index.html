<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Performance Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="backdrop">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
  </div>

  <main class="shell">
    <header class="hero">
      <div class="hero-text">
        <p class="eyebrow">Support Ops · Live Gleap metrics</p>
        <h1>Team Performance Dashboard</h1>
        <p class="lede">
          IST selections are converted to UTC before hitting Gleap.
          <span id="lastUpdated" class="muted-text"></span>
        </p>
      </div>
      <div class="hero-actions">
        <span class="pill">IST → UTC</span>
        <label class="switch">
          <input type="checkbox" id="autoRefresh" />
          <span class="slider"></span>
          <span class="switch-label">Auto refresh (5m)</span>
        </label>
        <button id="exportBtn" class="ghost-btn" type="button">Export CSV</button>
      </div>
    </header>

    <section class="panel controls">
      <div class="control-group">
        <label for="startInput">Start (IST)</label>
        <input type="datetime-local" id="startInput" />
      </div>
      <div class="control-group">
        <label for="endInput">End (IST)</label>
        <input type="datetime-local" id="endInput" />
      </div>
      <button id="fetchBtn" class="primary-btn" type="button">
        <span class="btn-label">Fetch Data</span>
        <span id="fetchBtnSpinner" class="btn-progress"></span>
      </button>
      <div class="quick-buttons">
        <span class="quick-label muted-text">Quick ranges</span>
        <div class="quick-actions">
          <button type="button" data-hours="1">Last 1 Hour</button>
          <button type="button" data-hours="2">Last 2 Hours</button>
          <button type="button" data-hours="4">Last 4 Hours</button>
          <button type="button" data-hours="24">Last 24 Hours</button>
        </div>
      </div>
    </section>

    <div id="errorBanner" class="alert hidden"></div>

    <section class="summary-grid">
      <article class="card">
        <p class="card-label">Total Tickets</p>
        <p class="card-value" id="totalTicketsValue">--</p>
        <p class="card-sub muted-text">Across the selected range</p>
      </article>
      <article class="card">
        <p class="card-label">Average Rating</p>
        <p class="card-value" id="averageRatingValue">--</p>
        <p class="card-sub muted-text">Emoji stripped numeric score</p>
      </article>
      <article class="card">
        <p class="card-label">Active Agents</p>
        <p class="card-value" id="totalAgentsValue">--</p>
        <p class="card-sub muted-text">Unknown agents are filtered out</p>
      </article>
    </section>

    <section class="panel table-card">
      <div class="table-head">
        <div>
          <h2>Agent Performance</h2>
          <p class="caption muted-text">
            Sorted by total tickets. Showing <span id="visibleAgentsCount">0</span> agents.
          </p>
        </div>
        <div class="table-tools">
          <input id="agentSearch" type="search" placeholder="Search name or email" />
        </div>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Agent</th>
              <th data-sort="ticket_activity" class="sortable active">Ticket Worked <span class="sort-indicator">↓</span></th>
              <th data-sort="closed_tickets" class="sortable">Closed</th>
              <th data-sort="median_reply_seconds" class="sortable">Median Reply</th>
              <th data-sort="median_first_reply_seconds" class="sortable">First Reply</th>
              <th data-sort="median_assignment_reply_seconds" class="sortable">Assign Reply</th>
              <th data-sort="time_to_last_close_seconds" class="sortable">Time To Last Close</th>
              <th data-sort="rating_score" class="sortable">Rating</th>
              <th data-sort="hours_active" class="sortable">Hours Active</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr><td colspan="9" class="no-data">Fetching data...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loader">
      <div class="spinner"></div>
      <p class="loader-text">Loading metrics...</p>
    </div>
  </div>

  <script src="dashboard.js"></script>
</body>
</html>
