<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Performance Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="backdrop">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
  </div>

  <main class="shell">
    <header class="hero">
      <div class="hero-text">
        <p class="eyebrow">Support Ops · Live Gleap metrics</p>
        <h1>Team Performance Dashboard</h1>
        <p class="lede">
          IST selections are converted to UTC before hitting Gleap.
          <span id="lastUpdated" class="muted-text"></span>
        </p>
      </div>
      <div class="hero-actions">
        <span class="pill">IST → UTC</span>
        <label class="switch">
          <input type="checkbox" id="autoRefresh" />
          <span class="slider"></span>
          <span class="switch-label">Auto refresh (5m)</span>
        </label>
        <button id="exportBtn" class="ghost-btn" type="button">Export CSV</button>
      </div>
    </header>

    <section class="panel controls">
      <div class="control-group">
        <label for="startInput">Start (IST)</label>
        <input type="datetime-local" id="startInput" />
      </div>
      <div class="control-group">
        <label for="endInput">End (IST)</label>
        <input type="datetime-local" id="endInput" />
      </div>
      <button id="fetchBtn" class="primary-btn" type="button">
        <span class="btn-label">Fetch Data</span>
        <span id="fetchBtnSpinner" class="btn-progress"></span>
      </button>
      <div class="quick-buttons">
        <span class="quick-label muted-text">Quick ranges</span>
        <div class="quick-actions">
          <button type="button" data-hours="1">Last 1 Hour</button>
          <button type="button" data-hours="2">Last 2 Hours</button>
          <button type="button" data-hours="4">Last 4 Hours</button>
          <button type="button" data-hours="24">Last 24 Hours</button>
          <article class="card">
            <p class="card-label">Average Rating</p>
            <p class="card-value" id="averageRatingValue">--</p>
            <p class="card-sub muted-text">Emoji stripped numeric score</p>
          </article>
          <article class="card">
            <p class="card-label">Active Agents</p>
            <p class="card-value" id="totalAgentsValue">--</p>
            <p class="card-sub muted-text">Unknown agents are filtered out</p>
          </article>
    </section>

    <section class="panel table-card">
      <div class="table-head">
        <div>
          <h2>Agent Performance</h2>
          <p class="caption muted-text">
            Sorted by total tickets. Showing <span id="visibleAgentsCount">0</span> agents.
          </p>
        </div>
        <div class="table-tools">
          <input id="agentSearch" type="search" placeholder="Search name or email" />
        </div>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Agent</th>
              <th data-sort="ticket_activity" class="sortable active">Ticket Worked <span
                  class="sort-indicator">↓</span></th>
              <th data-sort="closed_tickets" class="sortable">Closed</th>
              <th data-sort="median_reply_seconds" class="sortable">Median Reply</th>
              <th data-sort="median_first_reply_seconds" class="sortable">First Reply</th>
              <th data-sort="rating_score" class="sortable">Rating</th>
              <th data-sort="last_seen_iso" class="sortable">Last Seen Date</th>
              <th data-sort="last_seen_iso" class="sortable">Last Seen Time</th>
              <th data-sort="hours_active" class="sortable">Hours Active</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="9" class="no-data">Fetching data...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    </div>

    <div id="shiftsView" class="hidden"></div>
    <div id="archivedView" class="hidden">
      <section class="panel table-card">
        <div class="table-head">
          <div>
            <h2>Archived Tickets</h2>
            <p class="caption muted-text">Tickets archived in the selected time window (IST)</p>
          </div>
          <div class="table-tools">
            <select id="archivedWindow" class="window-selector">
              <option value="30">Last 30 min</option>
              <option value="60" selected>Last 1 hour</option>
              <option value="120">Last 2 hours</option>
              <option value="240">Last 4 hours</option>
              <option value="480">Last 8 hours</option>
            </select>
            <input id="archivedSearch" type="search" placeholder="Search name or email" />
          </div>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Agent</th>
                <th>Archived Count</th>
                <th>Latest Date</th>
                <th>Latest Time</th>
                <th>Last Seen</th>
              </tr>
            </thead>
            <tbody id="archivedTableBody">
              <tr>
                <td colspan="5" class="no-data">Fetching data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Hourly Breakdown Section -->
      <section class="panel" style="margin-top: 20px;">
        <div class="table-head">
          <div>
            <h2>Hourly Breakdown</h2>
            <p class="caption muted-text">Tickets archived per hour with agent details (IST)</p>
          </div>
        </div>
        <div id="archivedHourlyBreakdown" class="hourly-breakdown-container">
          <!-- Populated by JavaScript -->
        </div>
      </section>
    </div>
    <div class="shifts-container">
      <!-- Morning Shift -->
      <section class="panel shift-panel" id="shiftMorning">
        <div class="shift-header">
          <div class="shift-title">
            <h3>Morning Shift</h3>
            <span class="shift-time">05:00 AM - 02:00 PM</span>
          </div>
          <div class="shift-stat">
            <span class="label">Shift Total</span>
            <span class="value" id="morningTotal">--</span>
          </div>
        </div>
        <div class="table-wrapper">
          <table class="shift-table">
            <thead>
              <tr>
                <th>Agent</th>
                <th>Tickets</th>
                <th>Rating</th>
                <th>Last Seen</th>
              </tr>
            </thead>
            <tbody id="morningBody"></tbody>
          </table>
        </div>
      </section>
      <!-- Noon Shift -->
      <section class="panel shift-panel" id="shiftNoon">
        <div class="shift-header">
          <div class="shift-title">
            <h3>Noon Shift</h3>
            <span class="shift-time">12:00 PM - 09:00 PM</span>
          </div>
          <div class="shift-stat">
            <span class="label">Shift Total</span>
            <span class="value" id="noonTotal">--</span>
          </div>
        </div>
        <div class="table-wrapper">
          <table class="shift-table">
            <thead>
              <tr>
                <th>Agent</th>
                <th>Tickets</th>
                <th>Rating</th>
                <th>Last Seen</th>
              </tr>
            </thead>
            <tbody id="noonBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Night Shift -->
      <section class="panel shift-panel" id="shiftNight">
        <div class="shift-header">
          <div class="shift-title">
            <h3>Night Shift</h3>
            <span class="shift-time">08:00 PM - 05:00 AM</span>
          </div>
          <div class="shift-stat">
            <span class="label">Shift Total</span>
            <span class="value" id="nightTotal">--</span>
          </div>
        </div>
        <div class="table-wrapper">
          <table class="shift-table">
            <thead>
              <tr>
                <th>Agent</th>
                <th>Tickets</th>
                <th>Rating</th>
                <th>Last Seen</th>
              </tr>
            </thead>
            <tbody id="nightBody"></tbody>
          </table>
        </div>
      </section>
    </div>

    <!-- Hourly Matrix -->
    <section class="panel table-card hidden" id="hourlySection" style="margin-top: 24px;">
      <div class="table-head">
        <div>
          <h2>Hourly Breakdown</h2>
          <p class="caption muted-text">Tickets worked per hour (IST)</p>
        </div>
      </div>
      <div class="table-wrapper" style="overflow-x: auto;">
        <table class="hourly-table">
          <thead>
            <tr id="hourlyMatrixHeader">
              <th class="sticky-col">Agent</th>
              <th>00</th>
              <th>01</th>
              <th>02</th>
              <th>03</th>
              <th>04</th>
              <th>05</th>
              <th>06</th>
              <th>07</th>
              <th>08</th>
              <th>09</th>
              <th>10</th>
              <th>11</th>
              <th>12</th>
              <th>13</th>
              <th>14</th>
              <th>15</th>
              <th>16</th>
              <th>17</th>
              <th>18</th>
              <th>19</th>
              <th>20</th>
              <th>21</th>
              <th>22</th>
              <th>23</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody id="hourlyMatrixBody">
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>
    </section>
    </div>
  </main>

  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loader">
      <div class="spinner"></div>
      <p class="loader-text">Loading metrics...</p>
    </div>
  </div>

  <script src="dashboard.js"></script>
</body>

</html>